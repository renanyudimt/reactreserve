{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport connectDb from \"../../utils/connectDb\";\nimport User from \"../../models/User\";\nimport bcrypt from \"bcrypt\";\nimport jwt from \"jsonwebtoken\";\nimport React from \"react\";\nimport { GlobalState } from '../../utils/context';\nconnectDb();\nexport default (async (req, res) => {\n  const {\n    email,\n    password\n  } = req.body;\n  const [state, setState] = React.useContext(GlobalState);\n\n  try {\n    //1) Check if user exist\n    const user = await User.findOne({\n      email\n    }).select(\"+password\"); //no model, select ta false, entao nao tras, com esse select, vai mostrar se achar um usuario com email tal\n    //2) --if not, return error\n\n    if (!user) {\n      return res.json({\n        success: false,\n        msg: \"User email or password is incorrect\"\n      });\n    } //3) check if users password is correct\n\n\n    const passMatch = await bcrypt.compare(password, user.password); //comparando os 2 \n    //4) --if so, generate token\n\n    if (passMatch) {\n      const token = jwt.sign({\n        userId: user._id\n      }, process.env.JWT_SECRET, {\n        expiresIn: \"7d\"\n      });\n      setState(state => _objectSpread(_objectSpread({}, state), {}, {\n        user: user,\n        token: token\n      }));\n      console.log(state); //5) send token to client\n\n      return res.json({\n        success: true,\n        token: token\n      });\n    } else {\n      return res.json({\n        success: false,\n        msg: \"User email or password is incorrect\"\n      });\n    }\n  } catch (error) {\n    console.log(error);\n    res.status(500).send(\"Error logging in user\");\n  }\n});","map":{"version":3,"sources":["/Users/renanyudi/Sites/estudos/react-app/react-next/pages/api/login.js"],"names":["connectDb","User","bcrypt","jwt","React","GlobalState","req","res","email","password","body","state","setState","useContext","user","findOne","select","json","success","msg","passMatch","compare","token","sign","userId","_id","process","env","JWT_SECRET","expiresIn","console","log","error","status","send"],"mappings":";;;;;;AAAA,OAAOA,SAAP,MAAsB,uBAAtB;AACA,OAAOC,IAAP,MAAiB,mBAAjB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,GAAP,MAAgB,cAAhB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,WAAT,QAA4B,qBAA5B;AAEAL,SAAS;AAET,gBAAe,OAAOM,GAAP,EAAYC,GAAZ,KAAoB;AACjC,QAAM;AAAEC,IAAAA,KAAF;AAASC,IAAAA;AAAT,MAAsBH,GAAG,CAACI,IAAhC;AACA,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBR,KAAK,CAACS,UAAN,CAAiBR,WAAjB,CAA1B;;AAEA,MAAI;AACF;AACA,UAAMS,IAAI,GAAG,MAAMb,IAAI,CAACc,OAAL,CAAa;AAAEP,MAAAA;AAAF,KAAb,EAAwBQ,MAAxB,CAA+B,WAA/B,CAAnB,CAFE,CAE6D;AAE/D;;AACA,QAAI,CAACF,IAAL,EAAW;AACT,aAAOP,GAAG,CAACU,IAAJ,CAAS;AAAEC,QAAAA,OAAO,EAAE,KAAX;AAAkBC,QAAAA,GAAG,EAAE;AAAvB,OAAT,CAAP;AACD,KAPC,CASF;;;AACA,UAAMC,SAAS,GAAG,MAAMlB,MAAM,CAACmB,OAAP,CAAeZ,QAAf,EAAyBK,IAAI,CAACL,QAA9B,CAAxB,CAVE,CAU8D;AAEhE;;AACA,QAAIW,SAAJ,EAAe;AACb,YAAME,KAAK,GAAGnB,GAAG,CAACoB,IAAJ,CAAS;AAACC,QAAAA,MAAM,EAAEV,IAAI,CAACW;AAAd,OAAT,EAA8BC,OAAO,CAACC,GAAR,CAAYC,UAA1C,EAAsD;AAAEC,QAAAA,SAAS,EAAE;AAAb,OAAtD,CAAd;AACAjB,MAAAA,QAAQ,CAACD,KAAK,oCAASA,KAAT;AAAgBG,QAAAA,IAAI,EAAEA,IAAtB;AAA4BQ,QAAAA,KAAK,EAAEA;AAAnC,QAAN,CAAR;AACAQ,MAAAA,OAAO,CAACC,GAAR,CAAYpB,KAAZ,EAHa,CAIb;;AACA,aAAOJ,GAAG,CAACU,IAAJ,CAAS;AAAEC,QAAAA,OAAO,EAAE,IAAX;AAAiBI,QAAAA,KAAK,EAAEA;AAAxB,OAAT,CAAP;AACD,KAND,MAMO;AACL,aAAOf,GAAG,CAACU,IAAJ,CAAS;AAAEC,QAAAA,OAAO,EAAE,KAAX;AAAkBC,QAAAA,GAAG,EAAE;AAAvB,OAAT,CAAP;AACD;AAEF,GAvBD,CAuBE,OAAMa,KAAN,EAAa;AACbF,IAAAA,OAAO,CAACC,GAAR,CAAYC,KAAZ;AACAzB,IAAAA,GAAG,CAAC0B,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,uBAArB;AACD;AACF,CA/BD","sourcesContent":["import connectDb from \"../../utils/connectDb\";\nimport User from \"../../models/User\";\nimport bcrypt from \"bcrypt\";\nimport jwt from \"jsonwebtoken\";\nimport React from \"react\";\nimport { GlobalState } from '../../utils/context'; \n\nconnectDb();\n\nexport default async (req, res) => {\n  const { email, password } = req.body;\n  const [state, setState] = React.useContext(GlobalState);\n\n  try {\n    //1) Check if user exist\n    const user = await User.findOne({ email }).select(\"+password\") //no model, select ta false, entao nao tras, com esse select, vai mostrar se achar um usuario com email tal\n\n    //2) --if not, return error\n    if (!user) {\n      return res.json({ success: false, msg: \"User email or password is incorrect\" });\n    }\n\n    //3) check if users password is correct\n    const passMatch = await bcrypt.compare(password, user.password) //comparando os 2 \n\n    //4) --if so, generate token\n    if (passMatch) {\n      const token = jwt.sign({userId: user._id }, process.env.JWT_SECRET, { expiresIn: \"7d\" })\n      setState(state => ({...state, user: user, token: token}))\n      console.log(state)\n      //5) send token to client\n      return res.json({ success: true, token: token })\n    } else {\n      return res.json({ success: false, msg: \"User email or password is incorrect\" });\n    }\n\n  } catch(error) {\n    console.log(error); \n    res.status(500).send(\"Error logging in user\")\n  }\n}"]},"metadata":{},"sourceType":"module"}