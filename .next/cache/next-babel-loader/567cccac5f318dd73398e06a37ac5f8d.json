{"ast":null,"code":"import connectDb from \"../../utils/connectDb\";\nimport User from \"../../models/User\";\nimport bcrypt from \"bcrypt\";\nimport jwt from \"jsonwebtoken\";\nconnectDb();\nexport default (async (req, res) => {\n  const {\n    email,\n    password\n  } = req.body;\n\n  try {\n    //1) Check if user exist\n    const user = await User.findOne({\n      email\n    }).select(\"+password\"); //no model, select ta false, entao nao tras, com esse select, vai mostrar se achar um usuario com email tal\n    //2) --if not, return error\n\n    if (!user) {\n      return res.json({\n        success: false,\n        msg: \"User email or password is incorrect\"\n      });\n    } //3) check if users password is correct\n\n\n    const passMatch = await bcrypt.compare(password, user.password); //comparando os 2 \n    //4) --if so, generate token\n\n    if (passMatch) {\n      const token = jwt.sign({\n        userId: user._id\n      }, process.env.JWT_SECRET, {\n        expiresIn: \"7d\"\n      }); //5) send token to client\n\n      return res.json({\n        success: true,\n        token: token,\n        user: user\n      });\n    } else {\n      return res.json({\n        success: false,\n        msg: \"User email or password is incorrect\"\n      });\n    }\n  } catch (error) {\n    console.log(error);\n    res.status(500).send(\"Error logging in user\");\n  }\n});","map":null,"metadata":{},"sourceType":"module"}