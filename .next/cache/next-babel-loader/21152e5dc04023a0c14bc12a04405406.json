{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Button, Icon, Message, Segment, Form } from \"semantic-ui-react\";\nimport Link from \"next/link\";\nimport React, { useContext } from \"react\";\nimport catchErrors from \"../utils/catchErrors\";\nimport baseUrl from \"../utils/baseUrl\";\nimport axios from \"axios\";\nimport { useRouter } from \"next/router\";\nimport { handleLogin } from \"../utils/auth\";\nimport { Context } from \"../components/Store/Store\";\nimport { parseCookies, setCookie, destroyCookie } from 'nookies';\nimport cookies from \"js-cookie\";\nconst INITIAL_STATE = {\n  email: \"\",\n  password: \"\"\n};\n\nfunction Login() {\n  const [user, setUser] = React.useState(INITIAL_STATE);\n  const [disabled, setDisable] = React.useState(true);\n  const [loading, setLoading] = React.useState(false);\n  const [error, setError] = React.useState(\"\");\n  const router = useRouter();\n  const {\n    0: state,\n    1: dispatch\n  } = useContext(Context);\n  React.useEffect(() => {\n    //vamos validar os campos do form\n    const isUser = Object.values(user).every(el => Boolean(el));\n    isUser ? setDisable(false) : setDisable(true);\n  }, [user]);\n\n  function handleChange(event) {\n    const {\n      name,\n      value\n    } = event.target;\n    setUser(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n      [name]: value\n    }));\n  }\n\n  async function handleSubmit(event) {\n    event.preventDefault();\n\n    try {\n      const url = `${baseUrl}/api/login`;\n\n      const payload = _objectSpread(_objectSpread({}, user), {}, {\n        React: React\n      });\n\n      setLoading(true);\n      setError(\"\"); //pra nao deixar ela la pra sempre caso de um erro ne..\n\n      const response = await axios.post(url, payload);\n\n      if (response.data.success) {\n        dispatch({\n          type: \"SET_USER\",\n          user: response.data.user\n        });\n        handleLogin(response.data.token);\n      } else {\n        setError(response.data.msg);\n      }\n    } catch (error) {\n      catchErrors(error, setError);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return __jsx(React.Fragment, null, __jsx(Message, {\n    attached: true,\n    icon: \"privacy\",\n    header: \"Welcome back!\",\n    content: \"Log in with email and password\",\n    color: \"blue\"\n  }), __jsx(Form, {\n    error: Boolean(error),\n    loading: loading,\n    onSubmit: handleSubmit\n  }, __jsx(Message, {\n    error: true,\n    header: \"Oops!\",\n    content: error\n  }), __jsx(Segment, null, __jsx(Form.Input, {\n    fluid: true,\n    icon: \"envelope\",\n    iconPosition: \"left\",\n    label: \"E-mail\",\n    name: \"email\",\n    placeholder: \"E-mail\",\n    type: \"email\",\n    value: user.email,\n    onChange: handleChange\n  }), __jsx(Form.Input, {\n    fluid: true,\n    icon: \"lock\",\n    iconPosition: \"left\",\n    label: \"Password\",\n    name: \"password\",\n    placeholder: \"Password\",\n    type: \"password\",\n    value: user.password,\n    onChange: handleChange\n  }), __jsx(Button, {\n    icon: \"signup\",\n    type: \"submit\",\n    color: \"orange\",\n    content: \"Login\",\n    disabled: disabled\n  }))), __jsx(Message, {\n    attached: \"bottom\",\n    warning: true\n  }, __jsx(Icon, {\n    name: \"help\"\n  }), \"New user? \", \" \", __jsx(Link, {\n    href: \"/signup\"\n  }, __jsx(\"a\", null, \"Sign up here\")), \"  \", \" \", \" instead\"));\n}\n\nexport default Login;","map":null,"metadata":{},"sourceType":"module"}